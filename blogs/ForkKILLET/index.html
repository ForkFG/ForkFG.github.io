<!doctype html>
<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html" charset="UTF-8"/>
		<title>ForkKΨILLET's Blog</title>
		<link rel="stylesheet" type="text/css" href="https://icelava.ga/style.css">
		<link rel="stylesheet" type="text/css" href="https://icelava.ga/fa/css/font-awesome.min.css">
		<script type="text/javascript" src="https://icelava.ga/marked.min.js"></script>
		<script type="text/javascript" src="https://cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
		<script type="text/javascript" src="https://cdn.staticfile.org/jquery/1.10.2/jquery.min.js"></script>
		<script type="text/javascript" src="https://icelava.ga/jquery.color.js"></script>
		<style>
			#main
			{
				z-index: -3;
			}
			#m_search
			{
				position: relative;
				z-index: -3;
			}
			#search
			{
				transition: margin-top 1s;
				position: relative;
				z-index: -2;
			}
			#search_cover
			{
				display: block;
				position: absolute;
				z-index: -1;
				top: 0;
				width: 100%;
				height: 150px;
				background-color: #ffffff;
			}
			#btn_back
			{
				position: absolute;
				right: 35px;
				top: 15px;
				background-color: white;
				box-shadow: 0 3px 10px #0000004D;
			}
		</style>
	</head>
	<body>
		<p id="pos" class="title">ForkKILLET's Blog</p>
		<div id="main">
			<div id="m_search">
				<div>
					<p class="title">
						<i class="fa fa-list"></i> ForkKILLET 的文章列表
					</p>
				</div> <br>
				<p class="text no-gap center" id="search_title">
					<b>文章筛选器
					<i id="btn_hide_search" class="fa fa-angle-up"></i>
					<i id="btn_show_search" class="fa fa-angle-down"></i> </b> <br><br>
				</p>

				<div id="search_cover"></div>

				<div id="search" class="center">
					<p class="text no-gap">
						<i class="fa fa-fw fa-header"></i>
						<input id="input_title" type="text" name="title" placeholder="搜索文章标题" spellcheck="false" autocomplete="off">
						<br>

						<i class="fa fa-fw fa-tag"></i>
						<input id="input_tag" type="text" name="title" placeholder="搜索文章标签" spellcheck="false" autocomplete="off">
						<br>
					</p>
					<div id="search_submit" class="button">搜索</div>
				</div> <hr>

				<div id="contents"></div>
			</div>

			<div id="m_article"></div>
		</div>
		<script type="text/javascript" src="https://icelava.ga/main.js"></script>
		<script type="text/javascript">
			// Note: 筛选器的隐藏、显示特效。
			let $search = $("#search");
			$search.data("show", true);
			$("#btn_show_search").hide();
			$("#search_title").click(function()
			{
				$("#btn_hide_search").toggle();
				$("#btn_show_search").toggle();
				if ($search.data("show") === true)
				{
					$search.data("show", false);
					$search.css("marginTop", "-250px");
				}
				else
				{
					$search.data("show", true);
					$search.css("marginTop", "0");
				}
			});

			// Note: 重要：AJAX 请求返回目录摘要。

			let $search_submit = $("#search_submit");
			function upd_contents()
			{
				$search_submit.html(`搜索中 <i class="fa fa-spinner fa-spin">`);

				let s = "",
				title = $("#input_title").val(),
				tag = $("#input_tag").val();
				if (title || tag)
				{
					s += "?";
					if (title)
					{
						s += "title=" + title;
						if (tag)s += "&";
					}
					if (tag)s += "tag=" + tag;
				}

				AJAX("GET", "http://loli.icelava.ga/reader.php" + s, "application/x-www-form-urlencoded", null,
				function(XHR)
				{
					$("#search_submit").html("搜索");
					$("#contents").html(XHR.responseText);

					$("#contents>a").click(function()
					{
						$("#m_search").hide();
						$("#btn_back").show();
						let $m_article = $("#m_article");
						$m_article.html(`<p class='title'><i class='fa fa-spinner fa-spin'></i> 页面内容正在加载中，请稍等</p>`);
						$m_article.show();

						AJAX("GET", "http://loli.icelava.ga/load_md.php?name=blogs/ForkKILLET/" + $(this).data("name"), "application/x-www-form- urlencoded", null,
						function(XHR)
						{
							$m_article.html(marked(XHR.responseText));
							$("#btn_back").click(function()
							{
								$("#m_search").show();
								$("#m_article").hide();
								$("#btn_back").hide();
							});
						});
					});
				});
			}
			$search_submit.click(upd_contents);
			upd_contents();

			// Note: 插入 返回目录 按钮
			$("#pos").after(`<div id="btn_back" class="button">返回目录</div>`);
			$("#btn_back").hide();
		</script>
	</body>
</html>